'use strict';

var fs = require('fs');
var LRU = require('lru-cache');
var shebangCommand = require('shebang-command');

var shebangCache = new LRU({ max: 50, maxAge: 30 * 1000 });  (command) {
    var buffer;
    var fd;
    var shebang;

    (shebangCache.has(command)) {
        return shebangCache.get(command);
    }

    = new Buffer(150);

    try {
        fd = fs.openSync(command, 'r');
        fs.readSync(fd, buffer, 0, 150, 0);
        fs.closeSync(fd);
    } catch (e) {  }

    (null is returned if not a shebang)
    shebang = shebangCommand(buffer.toString());

    .set(command, shebang);

    return shebang;
}

module.exports = readShebang;
